<!-- analyzer/templates/analyzer/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>–õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; max-width: 800px; margin: 40px auto; padding: 20px; }
        textarea { width: 100%; height: 120px; padding: 10px; font-size: 16px; }
        button { padding: 12px 24px; margin-top: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; }
        .word-analysis { margin: 15px 0; padding: 15px; background: white; border-left: 4px solid #007bff; }
        .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üî§ –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∞–≤–∞—Ä—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</h1>
    <p>–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ –∞–≤–∞—Ä—Å–∫–æ–º —è–∑—ã–∫–µ –¥–ª—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</p>
    
    <form id="analyze-form">
        {% csrf_token %}
        <textarea 
            name="text" 
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫I–∞–ª—Å–∞ –≤–∞—áI–∞–Ω–∞..."
            id="text-input">–∫I–∞–ª—Å–∞ –≤–∞—áI–∞–Ω–∞</textarea>
        <br>
        <button type="submit">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
    </form>
    
    <div id="result" class="result" style="display: none;">
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å -->
    </div>
    
    <div style="margin-top: 40px;">
        <h3>–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
        <ul>
            <li><button onclick="setExample('–∫I–∞–ª—Å–∞ –≤–∞—áI–∞–Ω–∞')">–∫I–∞–ª—Å–∞ –≤–∞—áI–∞–Ω–∞</button> (–º–∞–ª—å—á–∏–∫ –ø—Ä–∏—à–µ–ª)</li>
            <li><button onclick="setExample('—Ö–≤–∞ –≤–∞—áI–∞–Ω–∞')">—Ö–≤–∞ –≤–∞—áI–∞–Ω–∞</button> (–¥–µ–≤–æ—á–∫–∞ –ø—Ä–∏—à–ª–∞)</li>
            <li><button onclick="setExample('–∫I–∞–ª –ª—ä—É–≥—å–∞–Ω–∞')">–∫I–∞–ª –ª—ä—É–≥—å–∞–Ω–∞</button> (–º–∞–ª—å—á–∏–∫ —É–ø–∞–ª)</li>
        </ul>
    </div>
    
    <script>
        function setExample(text) {
            document.getElementById('text-input').value = text;
        }
        
        document.getElementById('analyze-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...</p>';
            resultDiv.style.display = 'block';
            
            try {
                const response = await fetch('/analyzer/api/analyze/', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `<div class="error"><strong>–û—à–∏–±–∫–∞:</strong> ${data.error}</div>`;
                    return;
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                let html = `<h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞</h3>`;
                html += `<p><strong>–§—Ä–∞–∑–∞:</strong> ${data.result.phrase}</p>`;
                html += `<p><strong>–ü–µ—Ä–µ–≤–æ–¥:</strong> ${data.result.translation}</p>`;
                
                html += `<h4>–†–∞–∑–±–æ—Ä –ø–æ —Å–ª–æ–≤–∞–º:</h4>`;
                data.result.words.forEach(word => {
                    if (word.error) {
                        html += `<div class="error">${word.word}: ${word.error}</div>`;
                    } else {
                        html += `<div class="word-analysis">`;
                        html += `<strong>${word.word}</strong><br>`;
                        html += `üìù –ö–æ—Ä–µ–Ω—å: <strong>${word.root}</strong> (${word.root_gloss}, ${word.root_pos})<br>`;
                        
                        if (word.affixes && word.affixes.length > 0) {
                            html += `üîó –ê—Ñ—Ñ–∏–∫—Å—ã: `;
                            word.affixes.forEach(affix => {
                                html += `<code>${affix.affix}</code> ‚Üí ${affix.value} `;
                            });
                            html += `<br>`;
                        }
                        
                        if (word.remaining && word.remaining !== '') {
                            html += `‚ö†Ô∏è –ù–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω–∞—è —á–∞—Å—Ç—å: "${word.remaining}"<br>`;
                        }
                        
                        html += `</div>`;
                    }
                });
                
                // –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                html += `<details style="margin-top: 20px;">`;
                html += `<summary>üìã –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)</summary>`;
                html += `<pre style="background: #e9ecef; padding: 10px;">${JSON.stringify(data.result, null, 2)}</pre>`;
                html += `</details>`;
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><strong>–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:</strong> ${error.message}</div>`;
            }
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            document.querySelector('button[type="submit"]').click();
        });
    </script>
</body>
</html>